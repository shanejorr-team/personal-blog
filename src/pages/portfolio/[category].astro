---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import Lightbox from '../../components/Lightbox.astro';
import PhotoGridItem from '../../components/PhotoGridItem.astro';
import { getAllCategories, getAllCategoryPhotos } from '../../utils/db';
import { processPhotos } from '../../utils/processPhotos';
import { getCategoryTitle } from '../../utils/categories';

export async function getStaticPaths() {
  const categories = getAllCategories();
  return categories.map(category => ({
    params: { category },
    props: { category },
  }));
}

const { category } = Astro.props;

// Get and process photos
const photos = getAllCategoryPhotos(category);
const categoryImages = await processPhotos(photos);

const categoryName = getCategoryTitle(category);
---

<BaseLayout
  title={`${categoryName} - Photography Portfolio`}
  description={`Browse my ${categoryName.toLowerCase()} photography, organized by theme.`}
>
  <div class="container mx-auto px-4 py-12">
    <Breadcrumbs items={[
      { label: 'Portfolio', href: '/portfolio' },
      { label: categoryName }
    ]} />

    <div class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">{categoryName}</h1>
    </div>

    <div class="flex flex-wrap gap-4 justify-start">
      {categoryImages.map((image, index) => (
        <PhotoGridItem image={image} index={index} />
      ))}
    </div>

    {categoryImages.length === 0 && (
      <div class="text-center py-12">
        <p class="text-gray-600 dark:text-gray-400">
          No photos found in {categoryName}.
        </p>
      </div>
    )}
  </div>

  <Lightbox />
</BaseLayout>
