---
/**
 * InlineFigure - Optimized inline image component for MDX posts
 *
 * Features:
 * - Responsive images with multiple widths
 * - Modern formats (AVIF, WebP) with fallback
 * - Lazy loading for performance
 * - Dark mode support for figcaptions
 * - Consistent quality settings
 *
 * Usage in MDX:
 * ```mdx
 * import InlineFigure from '../../../components/InlineFigure.astro';
 * import photo from './my-photo.jpg';
 *
 * <InlineFigure src={photo} alt="Description" caption="Optional caption" />
 * ```
 */
import { Picture } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  src: ImageMetadata;
  alt: string;
  caption?: string;
  loading?: 'lazy' | 'eager';
  class?: string;
}

const {
  src,
  alt,
  caption,
  loading = 'lazy',
  class: className = ''
} = Astro.props;

// Responsive widths for different screen sizes
// These cover mobile, tablet, and desktop displays
const widths = [400, 800, 1200, 1600];

// Sizes attribute helps browser pick the right image
// Based on actual layout: container class with px-4 padding
// - Mobile: full width minus padding (100vw - 2rem)
// - Tablet: container width minus padding
// - Desktop: container maxes at ~1200px for content readability
const sizes = '(max-width: 640px) calc(100vw - 2rem), (max-width: 1024px) calc(100vw - 2rem), 1200px';
---

<figure>
  <Picture
    src={src}
    alt={alt}
    widths={widths}
    sizes={sizes}
    formats={['avif', 'webp']}
    quality={80}
    loading={loading}
    class:list={['rounded-lg', className]}
  />
  {caption && (
    <figcaption>{caption}</figcaption>
  )}
</figure>
